<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>QR Code Generator | D2D</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:ui-monospace,monospace;
  background:#000;
  color:#fff;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
}

.container{
  max-width:600px;
  width:100%;
  text-align:center;
}

h1{
  font-size:2rem;
  margin-bottom:10px;
  color:#0f0;
}

.subtitle{
  color:#666;
  font-size:0.9rem;
  margin-bottom:40px;
}

.qr-container{
  background:#fff;
  padding:40px;
  margin:30px auto;
  display:inline-block;
  border:4px solid #0f0;
}

#qr-canvas{
  image-rendering: pixelated;
}

.identity-card{
  background:#0a0a0a;
  border:2px solid #0f0;
  padding:20px;
  margin:20px 0;
}

.anon-name{
  font-size:1.5rem;
  color:#0f0;
  font-weight:700;
  letter-spacing:0.1em;
  margin-bottom:10px;
}

.detail{
  font-size:0.75rem;
  color:#666;
  margin:5px 0;
}

.instructions{
  background:#0a0a0a;
  border:1px solid #222;
  padding:20px;
  margin:20px 0;
  text-align:left;
}

.instructions h2{
  font-size:1.1rem;
  color:#0f0;
  margin-bottom:15px;
}

.instructions ol{
  margin-left:20px;
  color:#888;
  line-height:1.8;
}

.instructions ol li{
  margin-bottom:10px;
}

button{
  padding:15px 30px;
  background:#0f0;
  color:#000;
  border:none;
  font-family:inherit;
  font-weight:700;
  cursor:pointer;
  margin:10px 5px;
  font-size:1rem;
}

button:hover{
  background:#fff;
}

button.secondary{
  background:#222;
  color:#666;
}

button.secondary:hover{
  background:#333;
  color:#0f0;
}

.error{
  background:#050505;
  border:1px solid #f00;
  padding:20px;
  color:#f00;
  margin:20px 0;
}

.note{
  background:#050505;
  border:1px solid #222;
  padding:15px;
  margin:20px 0;
  color:#666;
  font-size:0.85rem;
  line-height:1.6;
}

@media(max-width:768px){
  h1{
    font-size:1.5rem;
  }
  .qr-container{
    padding:20px;
  }
}
</style>
<!-- SEO/AEO/LLMEO Head -->
<title>QR Code Generator - Privacy-First Tool</title>
<meta name="description" content="Generate QR codes instantly. No tracking, no data collection. Your QR codes are created locally in your browser.">
<meta name="keywords" content="qr code generator, privacy qr, local qr generator, no tracking">
<meta name="author" content="Death2Data">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://death2data.com/tools/qr-generator.html">

<!-- Open Graph (Facebook, LinkedIn, Discord) -->
<meta property="og:type" content="website">
<meta property="og:site_name" content="Death2Data">
<meta property="og:title" content="QR Code Generator - Privacy-First Tool">
<meta property="og:description" content="Generate QR codes instantly. No tracking, no data collection. Your QR codes are created locally in your browser.">
<meta property="og:url" content="https://death2data.com/tools/qr-generator.html">
<meta property="og:image" content="https://death2data.com/og-image.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:locale" content="en_US">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@death2data">
<meta name="twitter:creator" content="@death2data">
<meta name="twitter:title" content="QR Code Generator - Privacy-First Tool">
<meta name="twitter:description" content="Generate QR codes instantly. No tracking, no data collection. Your QR codes are created locally in your browser.">
<meta name="twitter:image" content="https://death2data.com/og-image.png">

<!-- JSON-LD for AI Engines (GPT, Claude, Perplexity) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "QR Code Generator - Privacy-First Tool",
  "description": "Generate QR codes instantly. No tracking, no data collection. Your QR codes are created locally in your browser.",
  "url": "https://death2data.com/tools/qr-generator.html",
  "provider": {
    "@type": "Organization",
    "name": "Death2Data",
    "url": "https://death2data.com",
    "email": "matt@death2data.com"
  }
}
</script>


<!-- Favicon -->
<link rel="icon" href="/favicon.svg" type="image/svg+xml">
<link rel="icon" href="/favicon.ico" sizes="32x32">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">

<!-- PWA -->
<link rel="manifest" href="/site.webmanifest">
<meta name="theme-color" content="#0a0a0a">

</head>
<body>

<div class="container">
  <h1>QR CODE GENERATOR</h1>
  <p class="subtitle">Display your D2D identity at events</p>

  <div id="loading" style="display:none">
    <p style="color:#666;padding:40px">Generating QR code...</p>
  </div>

  <div id="error" class="error" style="display:none"></div>

  <div id="qr-display" style="display:none">
    <div class="qr-container">
      <div id="qr-code"></div>
    </div>

    <div class="identity-card">
      <div class="anon-name" id="anon-name-display">LOADING...</div>
      <div class="detail">Show this QR code to add you to Trust Circles</div>
    </div>

    <button onclick="downloadQR()">Download QR Code</button>
    <button class="secondary" onclick="shareQR()">Share</button>
    <button class="secondary" onclick="printQR()">Print</button>

    <div class="instructions">
      <h2>HOW TO USE AT EVENTS</h2>
      <ol>
        <li><strong>Show this QR code</strong> - Display on your phone or print it</li>
        <li><strong>Others scan it</strong> - They add you to their Trust Circle</li>
        <li><strong>Later online</strong> - When you message them, they can verify it's really you</li>
        <li><strong>No personal info</strong> - Just your anon name and public key</li>
      </ol>
    </div>

    <div class="note">
      <strong>What's in the QR code?</strong><br>
      Your anonymous name (e.g., GHOST-VOID-2163) and public key.<br>
      NOT your private key. NOT your email. NOT your real identity.<br>
      Safe to share publicly.
    </div>
  </div>

  <div id="no-identity" style="display:none">
    <div class="error">
      ✗ No D2D identity found.<br><br>
      Please complete signup first to generate your identity.
    </div>
    <button onclick="goToSignup()">Go to Signup</button>
  </div>
</div>

<script>
// ═══════════════════════════════════════════════════════════════════════════════
// LOAD IDENTITY
// ═══════════════════════════════════════════════════════════════════════════════

let publicKeyPEM = '';
let anonName = '';
let qrData = '';

async function init() {
  // Load from localStorage
  publicKeyPEM = localStorage.getItem('d2d_public_key');
  anonName = localStorage.getItem('d2d_anon_name');

  if (!publicKeyPEM || !anonName) {
    document.getElementById('no-identity').style.display = 'block';
    return;
  }

  // Create QR data package
  qrData = JSON.stringify({
    version: '1.0',
    type: 'd2d_identity',
    anonName: anonName,
    publicKey: publicKeyPEM,
    timestamp: new Date().toISOString()
  });

  // Generate QR code
  document.getElementById('loading').style.display = 'block';

  try {
    await generateQR(qrData);
    document.getElementById('anon-name-display').textContent = anonName;
    document.getElementById('loading').style.display = 'none';
    document.getElementById('qr-display').style.display = 'block';
  } catch (e) {
    document.getElementById('loading').style.display = 'none';
    document.getElementById('error').textContent = `Error generating QR code: ${e.message}`;
    document.getElementById('error').style.display = 'block';
  }
}

// ═══════════════════════════════════════════════════════════════════════════════
// QR CODE GENERATION (Real scannable QR codes using qrcode.js)
// ═══════════════════════════════════════════════════════════════════════════════

let qrCodeInstance = null;

function generateQR(data) {
  return new Promise((resolve, reject) => {
    try {
      // Clear any existing QR code
      const container = document.getElementById('qr-code');
      container.innerHTML = '';

      // Generate real scannable QR code
      qrCodeInstance = new QRCode(container, {
        text: data,
        width: 400,
        height: 400,
        colorDark: '#000000',
        colorLight: '#ffffff',
        correctLevel: QRCode.CorrectLevel.H
      });

      resolve();
    } catch (e) {
      reject(e);
    }
  });
}

// ═══════════════════════════════════════════════════════════════════════════════
// ACTIONS
// ═══════════════════════════════════════════════════════════════════════════════

function downloadQR() {
  const qrImg = document.querySelector('#qr-code img');
  if (!qrImg) return;

  const link = document.createElement('a');
  link.download = `d2d-qr-${anonName.toLowerCase()}.png`;
  link.href = qrImg.src;
  link.click();
}

function shareQR() {
  const qrImg = document.querySelector('#qr-code img');
  if (!qrImg) {
    copyQRData();
    return;
  }

  // Web Share API
  if (navigator.share) {
    fetch(qrImg.src)
      .then(res => res.blob())
      .then(blob => {
        const file = new File([blob], `d2d-qr-${anonName}.png`, { type: 'image/png' });
        navigator.share({
          title: `D2D Identity: ${anonName}`,
          text: 'Scan to add me to your Trust Circle',
          files: [file]
        }).catch(err => {
          console.log('Share failed:', err);
          copyQRData();
        });
      });
  } else {
    copyQRData();
  }
}

function copyQRData() {
  navigator.clipboard.writeText(qrData);
  alert('✓ QR data copied to clipboard!\n\nYou can paste this to share your identity.');
}

function printQR() {
  const qrImg = document.querySelector('#qr-code img');
  if (!qrImg) return;

  // Create printable version
  const printWindow = window.open('', '_blank');

  printWindow.document.write(`
    <!DOCTYPE html>
    <html>
    <head>
      <title>D2D QR Code - ${anonName}</title>
      <style>
        body {
          font-family: monospace;
          text-align: center;
          padding: 40px;
        }
        img {
          border: 4px solid #0f0;
          padding: 20px;
          background: white;
        }
        h1 {
          font-size: 2rem;
          margin: 20px 0;
        }
        p {
          color: #666;
          margin: 10px 0;
        }
      </style>
    <!-- SEO/AEO/LLMEO Head -->
<title>QR Code Generator - Privacy-First Tool</title>
<meta name="description" content="Generate QR codes instantly. No tracking, no data collection. Your QR codes are created locally in your browser.">
<meta name="keywords" content="qr code generator, privacy qr, local qr generator, no tracking">
<meta name="author" content="Death2Data">
<meta name="robots" content="index, follow">
<link rel="canonical" href="https://death2data.com/tools/qr-generator.html">

<!-- Open Graph (Facebook, LinkedIn, Discord) -->
<meta property="og:type" content="website">
<meta property="og:site_name" content="Death2Data">
<meta property="og:title" content="QR Code Generator - Privacy-First Tool">
<meta property="og:description" content="Generate QR codes instantly. No tracking, no data collection. Your QR codes are created locally in your browser.">
<meta property="og:url" content="https://death2data.com/tools/qr-generator.html">
<meta property="og:image" content="https://death2data.com/og-image.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:locale" content="en_US">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@death2data">
<meta name="twitter:creator" content="@death2data">
<meta name="twitter:title" content="QR Code Generator - Privacy-First Tool">
<meta name="twitter:description" content="Generate QR codes instantly. No tracking, no data collection. Your QR codes are created locally in your browser.">
<meta name="twitter:image" content="https://death2data.com/og-image.png">

<!-- JSON-LD for AI Engines (GPT, Claude, Perplexity) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "QR Code Generator - Privacy-First Tool",
  "description": "Generate QR codes instantly. No tracking, no data collection. Your QR codes are created locally in your browser.",
  "url": "https://death2data.com/tools/qr-generator.html",
  "provider": {
    "@type": "Organization",
    "name": "Death2Data",
    "url": "https://death2data.com",
    "email": "matt@death2data.com"
  }
}
</script>


<!-- Favicon -->
<link rel="icon" href="/favicon.svg" type="image/svg+xml">
<link rel="icon" href="/favicon.ico" sizes="32x32">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">

<!-- PWA -->
<link rel="manifest" href="/site.webmanifest">
<meta name="theme-color" content="#0a0a0a">

</head>
    <body>
      <img src="${qrImg.src}" width="400">
      <h1>${anonName}</h1>
      <p>Scan to add me to your D2D Trust Circle</p>
      <p>death2data.com</p>
    </body>
    </html>
  `);

  printWindow.document.close();
  setTimeout(() => {
    printWindow.print();
  }, 500);
}

function goToSignup() {
  window.location.href = '/';
}

// ═══════════════════════════════════════════════════════════════════════════════
// INIT
// ═══════════════════════════════════════════════════════════════════════════════

init();
</script>

</body>
</html>
