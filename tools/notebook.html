<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>28-Day Notebook | Death2Data</title>
<meta name="description" content="Pick any topic. Answer one question per day for 28 days. Everything stored locally on your device.">
<link rel="icon" href="/favicon.svg" type="image/svg+xml">
<link rel="manifest" href="/site.webmanifest">
<meta name="theme-color" content="#0a0a0a">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@700&display=swap');

:root {
  --bg: #0a0a0a;
  --surface: #111;
  --border: #1e1e1e;
  --border-hover: #2a3a2a;
  --text: #e0e0e0;
  --text-body: #b0b0b0;
  --text-muted: #666;
  --text-dim: #444;
  --green: #00cc44;
  --green-dim: #004d1a;
  --green-hover: #00e64d;
  --red: #cc0000;
  --font: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  --mono: 'JetBrains Mono', monospace;
  --pad: 16px;
  --radius: 8px;
}

*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
a { color: inherit; text-decoration: none; }
html, body { min-height:100%; }
body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  display: flex;
  flex-direction: column;
  -webkit-font-smoothing: antialiased;
}

/* === HEADER === */
.hd {
  display: flex;
  align-items: center;
  padding: 0 var(--pad);
  height: 48px;
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
  gap: 12px;
}
.hd-logo {
  font-family: var(--mono);
  font-weight: 700;
  font-size: 14px;
  color: var(--green);
  letter-spacing: 1px;
  margin-right: auto;
}
.hd a:not(.hd-logo) { color: var(--text-muted); font-size: 13px; }
.hd a:not(.hd-logo):hover { color: var(--text); }

/* === MAIN === */
.main {
  flex: 1;
  max-width: 600px;
  margin: 0 auto;
  width: 100%;
  padding: 32px var(--pad) 80px;
}

/* === PAGES === */
.page { display: none; }
.page.active { display: block; }

/* === LANDING === */
.landing-title {
  font-size: 24px;
  font-weight: 600;
  margin-bottom: 8px;
}
.landing-title .accent { color: var(--green); }
.landing-sub {
  color: var(--text-muted);
  font-size: 14px;
  line-height: 1.6;
  margin-bottom: 32px;
}

.topic-box {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 16px;
}
.topic-box label {
  display: block;
  font-size: 11px;
  color: var(--text-muted);
  letter-spacing: 1px;
  margin-bottom: 10px;
}
.topic-box input {
  width: 100%;
  padding: 14px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  color: var(--text);
  font-family: var(--font);
  font-size: 15px;
  outline: none;
}
.topic-box input:focus { border-color: var(--green); }

.start-btn {
  display: block;
  width: 100%;
  padding: 16px;
  background: var(--green);
  color: #000;
  text-align: center;
  font-weight: 600;
  font-size: 14px;
  font-family: var(--font);
  border: none;
  border-radius: var(--radius);
  cursor: pointer;
  transition: background .2s;
}
.start-btn:hover { background: var(--green-hover); }
.start-btn:disabled { background: var(--border); color: var(--text-dim); cursor: not-allowed; }

.landing-note {
  text-align: center;
  font-size: 12px;
  color: var(--text-dim);
  margin-top: 12px;
}

/* Domain picker */
.domain-picker {
  margin-top: 32px;
  margin-bottom: 8px;
}
.domain-picker h3 {
  font-size: 11px;
  color: var(--text-muted);
  letter-spacing: 1px;
  margin-bottom: 6px;
}
.domain-picker-sub {
  font-size: 12px;
  color: var(--text-dim);
  margin-bottom: 14px;
  line-height: 1.5;
}
#domainGrid {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}
.domain-chip {
  padding: 7px 12px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 6px;
  font-size: 12px;
  color: var(--text-body);
  cursor: pointer;
  transition: border-color .2s, color .2s;
}
.domain-chip:hover {
  border-color: var(--green-dim);
  color: var(--green);
}
.domain-chip .chip-name {
  font-weight: 500;
  color: var(--text);
}
.domain-chip:hover .chip-name { color: var(--green); }

.how-it-works {
  margin-top: 32px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
}
.how-it-works h3 {
  font-size: 11px;
  color: var(--text-muted);
  letter-spacing: 1px;
  margin-bottom: 14px;
}
.how-step {
  display: flex;
  gap: 12px;
  padding: 8px 0;
}
.how-step .step-num {
  font-family: var(--mono);
  font-size: 12px;
  color: var(--green-dim);
  flex-shrink: 0;
  padding-top: 1px;
}
.how-step .step-text {
  font-size: 13px;
  color: var(--text-body);
  line-height: 1.5;
}

/* === NOTEBOOK === */
.agent-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  margin-bottom: 24px;
  font-size: 12px;
}
.agent-status {
  display: flex;
  align-items: center;
  gap: 8px;
}
.agent-dot {
  width: 8px; height: 8px;
  background: var(--green);
  border-radius: 50%;
  animation: pulse 2s infinite;
}
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }
.agent-dot.done { background: var(--text-dim); animation: none; }
.agent-label { color: var(--green); font-weight: 500; }
.agent-label.done { color: var(--text-muted); }
.agent-timer { color: var(--text-muted); }
.agent-timer strong { color: var(--green); }

.nb-header { margin-bottom: 24px; }
.nb-header h2 { font-size: 18px; margin-bottom: 4px; }
.nb-header h2 .topic { color: var(--green); }
.nb-header p { font-size: 13px; color: var(--text-muted); }

.progress-wrap { margin-bottom: 24px; }
.progress-meta {
  display: flex;
  justify-content: space-between;
  font-size: 11px;
  color: var(--text-muted);
  margin-bottom: 6px;
}
.progress-bar {
  height: 3px;
  background: var(--border);
  border-radius: 2px;
  overflow: hidden;
}
.progress-fill {
  height: 100%;
  background: var(--green);
  border-radius: 2px;
  transition: width .3s;
}

/* Today's cell */
.cell {
  background: var(--surface);
  border: 1px solid var(--border);
  border-left: 3px solid var(--green);
  border-radius: var(--radius);
  padding: 20px;
  margin-bottom: 20px;
}
.cell.locked { opacity: 0.4; pointer-events: none; border-left-color: var(--border); }
.cell-day {
  font-size: 10px;
  letter-spacing: 2px;
  color: var(--green);
  margin-bottom: 12px;
}
.cell-q {
  font-size: 15px;
  line-height: 1.5;
  margin-bottom: 16px;
}
.cell textarea {
  width: 100%;
  min-height: 120px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 14px;
  color: var(--text);
  font-family: var(--font);
  font-size: 14px;
  resize: vertical;
  outline: none;
  margin-bottom: 10px;
}
.cell textarea:focus { border-color: var(--green); }
.cell-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.cell-footer .hint { font-size: 11px; color: var(--text-dim); }
.cell-footer button {
  padding: 10px 20px;
  background: var(--green);
  color: #000;
  border: none;
  border-radius: 6px;
  font-family: var(--font);
  font-weight: 600;
  font-size: 13px;
  cursor: pointer;
}
.cell-footer button:hover { background: var(--green-hover); }

/* Paywall (after day 1) */
.nb-paywall {
  background: var(--surface);
  border: 1px dashed var(--green-dim);
  border-radius: var(--radius);
  padding: 24px;
  text-align: center;
  margin-bottom: 20px;
}
.nb-paywall h3 {
  font-size: 15px;
  margin-bottom: 6px;
}
.nb-paywall p {
  font-size: 13px;
  color: var(--text-muted);
  margin-bottom: 16px;
}
.nb-paywall a {
  display: inline-block;
  padding: 12px 28px;
  background: var(--green);
  color: #000;
  font-weight: 600;
  font-size: 14px;
  border-radius: var(--radius);
}

/* Past entries */
.past { margin-top: 32px; }
.past h3 {
  font-size: 11px;
  color: var(--text-muted);
  letter-spacing: 1px;
  margin-bottom: 12px;
}
.past-entry {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 14px;
  margin-bottom: 8px;
}
.past-head {
  display: flex;
  justify-content: space-between;
  font-size: 11px;
  margin-bottom: 6px;
}
.past-day { color: var(--green); }
.past-date { color: var(--text-dim); }
.past-q { font-size: 12px; color: var(--text-muted); margin-bottom: 6px; }
.past-a { font-size: 14px; line-height: 1.5; }

/* === FOOTER === */
.ft {
  display: flex;
  align-items: center;
  padding: 0 var(--pad);
  height: 44px;
  border-top: 1px solid var(--border);
  flex-shrink: 0;
  gap: 10px;
  font-size: 12px;
  background: var(--bg);
}
.ft a { color: var(--text-muted); }
.ft a:hover { color: var(--green); }
.ft-sep { color: var(--border); }
</style>
</head>
<body>

<!-- HEADER -->
<div class="hd">
  <a href="/" class="hd-logo">D2D</a>
  <a href="/">Search</a>
  <a href="/about.html">About</a>
  <a href="/tools.html">Tools</a>
</div>

<!-- MAIN -->
<div class="main">

  <!-- PAGE: LANDING -->
  <div class="page" id="pageLanding">
    <div class="landing-title">28-day <span class="accent">notebook</span></div>
    <p class="landing-sub">Pick any topic. Get one question per day. Write your answer. Everything stays on your device.</p>

    <div class="topic-box">
      <label>WHAT DO YOU WANT TO EXPLORE?</label>
      <input type="text" id="topicInput" placeholder="fermentation, grief, starting a business...">
    </div>

    <button class="start-btn" id="startBtn" disabled>Type a topic to start</button>
    <p class="landing-note">Day 1 is free. Full 28 days with membership.</p>

    <div class="domain-picker">
      <h3>OR PICK A DOMAIN TO EXPLORE</h3>
      <p class="domain-picker-sub">230 domains. One membership. Pick one and spend 28 days figuring out if it's worth building.</p>
      <div id="domainGrid"></div>
    </div>

    <div class="how-it-works">
      <h3>HOW IT WORKS</h3>
      <div class="how-step">
        <span class="step-num">01</span>
        <span class="step-text">Pick any topic — or a domain from the portfolio</span>
      </div>
      <div class="how-step">
        <span class="step-num">02</span>
        <span class="step-text">Answer one question per day — stored locally, never sent anywhere</span>
      </div>
      <div class="how-step">
        <span class="step-num">03</span>
        <span class="step-text">After 28 days, download your notebook as a file</span>
      </div>
    </div>
  </div>

  <!-- PAGE: NOTEBOOK -->
  <div class="page" id="pageNotebook">
    <div class="agent-bar">
      <div class="agent-status">
        <div class="agent-dot" id="agentDot"></div>
        <span class="agent-label" id="agentLabel">ACTIVE</span>
      </div>
      <div class="agent-timer" id="agentTimer"><strong>--</strong> days left</div>
    </div>

    <div class="nb-header">
      <h2>Exploring <span class="topic" id="nbTopic">--</span></h2>
      <p>One question per day for 28 days</p>
      <div id="nbLinks" style="display:flex;gap:10px;margin-top:10px;flex-wrap:wrap;"></div>
    </div>

    <div class="progress-wrap">
      <div class="progress-meta">
        <span>Progress</span>
        <span id="progressText">0 / 28</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width:0%"></div>
      </div>
    </div>

    <div id="paywallSlot"></div>

    <div class="cell" id="todayCell">
      <div class="cell-day" id="cellDay">DAY 1</div>
      <div class="cell-q" id="cellQ">Loading...</div>
      <textarea id="cellInput" placeholder="Write your thoughts..."></textarea>
      <div class="cell-footer">
        <span class="hint" id="saveHint"></span>
        <button onclick="saveEntry()">Save</button>
      </div>
    </div>

    <div class="past">
      <h3>PREVIOUS ENTRIES</h3>
      <div id="pastEntries"></div>
    </div>
  </div>

</div>

<!-- FOOTER -->
<div class="ft">
  <a href="/about.html">about</a>
  <span class="ft-sep">&middot;</span>
  <a href="/privacy.html">privacy</a>
  <span class="ft-sep">&middot;</span>
  <a href="mailto:matt@death2data.com">support</a>
</div>

<script>
const STRIPE_LINK = 'https://buy.stripe.com/cNieVd5Vjb6N2ZY6Fq4wM00';
const STORAGE_KEY = 'd2d_notebook';

const QUESTIONS = [
  "What do you already know about {topic}?",
  "Why does {topic} interest you?",
  "What's your earliest memory related to {topic}?",
  "Explain {topic} like you're talking to a curious kid.",
  "What confuses you most about {topic}?",
  "How did you first learn about {topic}?",
  "What would be different if {topic} didn't exist?",
  "How does {topic} show up in your daily life?",
  "What's a common misconception about {topic}?",
  "Who do you know that's good at {topic}? What makes them good?",
  "What's surprising about {topic}?",
  "How has {topic} changed over the last 50 years?",
  "What's the connection between {topic} and money?",
  "What emotions come up when you think about {topic}?",
  "What's the dark side of {topic}?",
  "Who benefits from {topic}? Who doesn't?",
  "What would an expert say you're missing?",
  "How would mastering {topic} change your life?",
  "What's one thing you could do TODAY related to {topic}?",
  "How does {topic} connect to your values?",
  "What have you learned about yourself through {topic}?",
  "What questions still remain?",
  "If you could change one thing about {topic}, what?",
  "Where will {topic} be in 10 years?",
  "What will you remember most from this?",
  "Who would you share your {topic} knowledge with?",
  "What's your final take on {topic}?",
  "Write a letter to past-you about {topic}."
];

// Top domains from the 230-domain portfolio
const DOMAINS = [
  {d:'sellthismvp.com', c:'AI pitch deck generator'},
  {d:'toneswitch.com', c:'AI writing tone adjuster'},
  {d:'ghostmemeter.com', c:'Are they ghosting you? AI analyzes it'},
  {d:'ipomyidea.com', c:'IPO simulator for startup ideas'},
  {d:'tweetaudit.com', c:'Analyze your Twitter tone'},
  {d:'knowwhatstuck.com', c:'AI debugging assistant'},
  {d:'whoswronghere.com', c:'AI argument settler'},
  {d:'adrgen.com', c:'Ad creative generator'},
  {d:'howmucharemyideasworth.com', c:'AI idea valuation'},
  {d:'howwasthevibe.com', c:'Post-event feedback tool'},
  {d:'soulfra.ai', c:'AI co-op matching builders to domains'},
  {d:'vibe-browser.com', c:'Browser that filters by vibe'},
  {d:'calclip.com', c:'Quick math during video calls'},
  {d:'thevibetool.com', c:'Mood tracker for daily vibes'},
];

let data = null;

// Check D2D membership
function isMember() {
  const token = localStorage.getItem('d2d_token');
  return !!token;
}

function init() {
  // Check if returning from Stripe
  const params = new URLSearchParams(location.search);
  if (params.get('paid') === '1') {
    const topic = localStorage.getItem('d2d_pending_topic') || 'your topic';
    localStorage.removeItem('d2d_pending_topic');
    data = {
      topic,
      startDate: Date.now(),
      paid: true,
      entries: {}
    };
    save();
    history.replaceState({}, '', location.pathname);
  } else {
    data = JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null');
  }

  // Support ?topic= param for direct links
  const topicParam = params.get('topic');
  if (topicParam && !data) {
    // Pre-fill the input but don't auto-start
    render();
    const input = document.getElementById('topicInput');
    if (input) {
      input.value = topicParam;
      input.dispatchEvent(new Event('input'));
    }
    return;
  }

  render();
}

function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

function render() {
  if (!data) {
    showPage('pageLanding');
    setupLanding();
    return;
  }
  showPage('pageNotebook');
  renderNotebook();
}

function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function setupLanding() {
  const input = document.getElementById('topicInput');
  const btn = document.getElementById('startBtn');

  input.addEventListener('input', () => {
    if (input.value.trim()) {
      btn.disabled = false;
      btn.textContent = 'Start day 1 — free';
    } else {
      btn.disabled = true;
      btn.textContent = 'Type a topic to start';
    }
  });

  btn.addEventListener('click', () => {
    const topic = input.value.trim();
    if (!topic) return;
    startNotebook(topic);
  });

  // Render domain chips
  const grid = document.getElementById('domainGrid');
  grid.innerHTML = DOMAINS.map(d =>
    `<div class="domain-chip" data-topic="${d.d}: ${d.c}">
      <span class="chip-name">${d.d}</span>
    </div>`
  ).join('');

  grid.querySelectorAll('.domain-chip').forEach(chip => {
    chip.addEventListener('click', () => {
      const topic = chip.dataset.topic;
      input.value = topic;
      input.dispatchEvent(new Event('input'));
      input.scrollIntoView({ behavior: 'smooth', block: 'center' });
    });
  });
}

function startNotebook(topic) {
  data = {
    topic,
    startDate: Date.now(),
    paid: isMember(),
    entries: {}
  };
  save();
  render();
}

function renderNotebook() {
  const topic = data.topic;
  const entries = data.entries || {};
  const completed = Object.keys(entries).length;
  const daysSinceStart = Math.floor((Date.now() - data.startDate) / (24*60*60*1000)) + 1;
  const currentDay = Math.min(Math.max(1, daysSinceStart), 28);
  const canAccess = currentDay === 1 || data.paid || isMember();

  // Agent bar
  const dot = document.getElementById('agentDot');
  const label = document.getElementById('agentLabel');
  const timer = document.getElementById('agentTimer');
  const daysLeft = Math.max(0, 28 - daysSinceStart + 1);

  if (daysLeft <= 0) {
    dot.classList.add('done');
    label.classList.add('done');
    label.textContent = 'COMPLETE';
    timer.innerHTML = '<strong>0</strong> days left';
  } else {
    timer.innerHTML = `<strong>${daysLeft}</strong> days left`;
  }

  // Header + progress + links back to search/story
  document.getElementById('nbTopic').textContent = topic;
  const searchQ = topic.split(':')[0].trim(); // use domain name or first part as query
  document.getElementById('nbLinks').innerHTML = `
    <a href="/?q=${encodeURIComponent(searchQ)}" style="font-size:12px;color:var(--green);text-decoration:none;padding:4px 10px;border:1px solid var(--green-dim);border-radius:4px;">Search D2D for this</a>
    <a href="/story.html?url=${encodeURIComponent('https://'+searchQ)}" style="font-size:12px;color:var(--text-muted);text-decoration:none;padding:4px 10px;border:1px solid var(--border);border-radius:4px;">Read ${searchQ} in Story Mode</a>
  `;
  document.getElementById('progressText').textContent = `${completed} / 28`;
  document.getElementById('progressFill').style.width = `${(completed/28)*100}%`;

  // Paywall check — show after day 1 if not paid
  const paywallSlot = document.getElementById('paywallSlot');
  if (!canAccess) {
    let stripeUrl = STRIPE_LINK;
    const email = localStorage.getItem('d2d_email');
    if (email) stripeUrl += '?prefilled_email=' + encodeURIComponent(email);
    paywallSlot.innerHTML = `
      <div class="nb-paywall">
        <h3>Day 1 complete</h3>
        <p>Unlock all 28 days with a $1/month D2D membership.</p>
        <a href="${stripeUrl}">Continue for $1/mo</a>
      </div>`;

    // Lock the cell
    document.getElementById('todayCell').classList.add('locked');
    document.getElementById('cellDay').textContent = `DAY ${currentDay} OF 28`;
    document.getElementById('cellQ').textContent = QUESTIONS[currentDay - 1].replace(/{topic}/g, topic);
    document.getElementById('cellInput').disabled = true;
  } else {
    paywallSlot.innerHTML = '';
    const cell = document.getElementById('todayCell');
    cell.classList.remove('locked');
    document.getElementById('cellDay').textContent = `DAY ${currentDay} OF 28`;
    document.getElementById('cellQ').textContent = QUESTIONS[currentDay - 1].replace(/{topic}/g, topic);
    document.getElementById('cellInput').value = entries[currentDay]?.answer || '';
    document.getElementById('cellInput').disabled = daysLeft <= 0;
    if (daysLeft <= 0) cell.classList.add('locked');
  }

  // Past entries
  const past = document.getElementById('pastEntries');
  const days = Object.keys(entries).filter(d => d != currentDay).sort((a,b) => b - a);
  if (days.length === 0) {
    past.innerHTML = '<p style="color:var(--text-dim);font-size:13px;">No previous entries yet</p>';
  } else {
    past.innerHTML = days.map(day => {
      const e = entries[day];
      const q = QUESTIONS[day-1] || QUESTIONS[0];
      return `<div class="past-entry">
        <div class="past-head">
          <span class="past-day">DAY ${day}</span>
          <span class="past-date">${new Date(e.date).toLocaleDateString()}</span>
        </div>
        <div class="past-q">${q.replace(/{topic}/g, topic)}</div>
        <div class="past-a">${e.answer}</div>
      </div>`;
    }).join('');
  }
}

function saveEntry() {
  const input = document.getElementById('cellInput');
  const answer = input.value.trim();
  if (!answer) return;

  const daysSinceStart = Math.floor((Date.now() - data.startDate) / (24*60*60*1000)) + 1;
  const currentDay = Math.min(Math.max(1, daysSinceStart), 28);

  if (!data.entries) data.entries = {};
  data.entries[currentDay] = { answer, date: Date.now() };
  save();

  document.getElementById('saveHint').textContent = 'Saved';
  renderNotebook();
}

init();
</script>
</body>
</html>
