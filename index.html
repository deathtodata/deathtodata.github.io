<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Death2Data</title>
<meta name="description" content="Search the web privately. Explore 230 domains. No tracking.">
<link rel="icon" href="/favicon.svg" type="image/svg+xml">
<link rel="icon" href="/favicon.ico" sizes="32x32">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="manifest" href="/site.webmanifest">
<meta name="theme-color" content="#0a0a0a">
<meta property="og:title" content="Death2Data">
<meta property="og:description" content="Search the web privately. No tracking. No ads.">
<meta property="og:url" content="https://death2data.com/">
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@700&display=swap');
:root {
  --bg: #0a0a0a;
  --surface: #111;
  --border: #1e1e1e;
  --text: #e0e0e0;
  --text-body: #b0b0b0;
  --text-muted: #666;
  --text-dim: #444;
  --green: #00cc44;
  --green-dim: #004d1a;
  --green-hover: #00e64d;
  --font: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  --mono: 'JetBrains Mono', monospace;
  --pad: 16px;
  --radius: 8px;
  --max-w: 560px;
}
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
a { color: inherit; text-decoration: none; }
body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  -webkit-font-smoothing: antialiased;
  min-height: 100vh;
}

/* === HEADER — just logo + nav === */
.hd {
  display: flex;
  align-items: center;
  padding: 0 var(--pad);
  height: 44px;
  border-bottom: 1px solid var(--border);
  gap: 12px;
  max-width: var(--max-w);
  margin: 0 auto;
}
.hd-logo {
  font-family: var(--mono);
  font-weight: 700;
  font-size: 14px;
  color: var(--green);
  letter-spacing: 1px;
  margin-right: auto;
}
.hd a:not(.hd-logo) { color: var(--text-dim); font-size: 12px; }
.hd a:not(.hd-logo):hover { color: var(--text-muted); }

/* === PAGE === */
.page {
  max-width: var(--max-w);
  margin: 0 auto;
  padding: 32px var(--pad) 80px;
}

/* === SEARCH BAR === */
.sbar {
  display: flex;
  margin-bottom: 32px;
}
.sbar input {
  flex: 1;
  height: 44px;
  padding: 0 14px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-right: none;
  border-radius: var(--radius) 0 0 var(--radius);
  color: var(--text);
  font-family: var(--font);
  font-size: 14px;
  outline: none;
}
.sbar input:focus { border-color: var(--green); }
.sbar input::placeholder { color: var(--text-dim); }
.sbar button {
  height: 44px;
  padding: 0 18px;
  background: var(--green);
  border: 1px solid var(--green);
  border-radius: 0 var(--radius) var(--radius) 0;
  color: #000;
  font-family: var(--font);
  font-weight: 600;
  font-size: 13px;
  cursor: pointer;
}
.sbar button:hover { background: var(--green-hover); }

/* === JOIN BOX === */
.join-row {
  display: flex;
  gap: 8px;
}
.join-row input {
  flex: 1;
  height: 38px;
  padding: 0 12px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  color: var(--text);
  font-family: var(--font);
  font-size: 13px;
  outline: none;
}
.join-row input:focus { border-color: var(--green); }
.join-row .join-btn {
  height: 38px;
  padding: 0 20px;
  background: var(--green);
  border: none;
  border-radius: 6px;
  color: #000;
  font-family: var(--font);
  font-weight: 600;
  font-size: 13px;
  cursor: pointer;
  white-space: nowrap;
}
.join-row .join-btn:hover { background: var(--green-hover); }

/* === FOOTER / AUTH === */
.ft {
  max-width: var(--max-w);
  margin: 0 auto;
  padding: 16px var(--pad);
  border-top: 1px solid var(--border);
  font-size: 12px;
  color: var(--text-dim);
}
.ft-row {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: wrap;
}
.ft a { color: var(--text-muted); }
.ft a:hover { color: var(--green); }
.ft-sep { color: var(--border); }
.ft-user {
  margin-top: 10px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 12px;
  color: var(--text-muted);
}
.ft-user .dot {
  width: 6px; height: 6px;
  background: var(--green);
  border-radius: 50%;
}
.ft-user button {
  background: none;
  border: none;
  color: var(--text-dim);
  font-family: var(--font);
  font-size: 11px;
  cursor: pointer;
}
.ft-user button:hover { color: var(--text-muted); }

/* === SEARCH RESULTS === */
.results-page { display: none; }
body.searching .home-page { display: none; }
body.searching .results-page { display: block; }
.meta {
  font-size: 12px;
  color: var(--text-muted);
  margin-bottom: 12px;
}
.results { margin-bottom: 40px; }
.card {
  padding: 14px;
  margin-bottom: 8px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  transition: border-color .15s;
  cursor: pointer;
}
.card:hover { border-color: var(--green-dim); }
.card-title {
  color: var(--green);
  font-size: 14px;
  font-weight: 500;
  line-height: 1.4;
  margin-bottom: 3px;
}
.card-url {
  font-size: 11px;
  color: var(--text-dim);
  margin-bottom: 6px;
}
.card-snip {
  font-size: 13px;
  color: var(--text-body);
  line-height: 1.5;
}
.paywall {
  padding: 20px;
  border: 1px dashed var(--green-dim);
  border-radius: var(--radius);
  text-align: center;
  margin-top: 12px;
}
.paywall p { font-size: 13px; color: var(--text-muted); margin-bottom: 12px; }
.paywall a {
  display: inline-block;
  padding: 10px 24px;
  background: var(--green);
  color: #000;
  font-weight: 600;
  font-size: 13px;
  border-radius: var(--radius);
}
.loading {
  text-align: center;
  padding: 40px 0;
  color: var(--text-dim);
  font-size: 13px;
}
</style>
</head>
<body>

<!-- HEADER -->
<div class="hd">
  <span class="hd-logo">D2D</span>
  <a href="/about.html">about</a>
  <a href="/tools.html">tools</a>
  <a href="/revenue.html">revenue</a>
</div>

<!-- HOME PAGE -->
<div class="page home-page">

  <!-- BRAND -->
  <div style="text-align:center;margin-bottom:24px;">
    <img src="/assets/d2d-mark.svg" alt="D2D" style="width:48px;height:48px;margin-bottom:12px;">
    <div style="font-family:var(--mono);font-size:20px;font-weight:700;color:var(--green);letter-spacing:2px;">DEATH2DATA</div>
    <div style="font-size:13px;color:var(--text-muted);margin-top:6px;">Search without being watched. $1/mo.</div>
    <div id="pulse" style="font-size:11px;color:var(--text-dim);margin-top:8px;"></div>
  </div>

  <div class="sbar">
    <input type="text" id="q" placeholder="search anything..." autocomplete="off"
           onkeydown="if(event.key==='Enter')doSearch()">
    <button onclick="doSearch()">Search</button>
  </div>

  <!-- THE CTA -->
  <div id="join-box" style="margin-bottom:24px;padding:16px 20px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);">
    <div id="join-cta"></div>
  </div>

  <!-- TOOLS -->
  <div style="font-size:12px;color:var(--text-muted);line-height:2;">
    <a href="/tools/leak-score.html" style="color:var(--text-body);">leak score</a> ·
    <a href="/tools/notebook.html" style="color:var(--text-body);">notebook</a> ·
    <a href="/tools/sanitizer.html" style="color:var(--text-body);">sanitizer</a> ·
    <a href="/tools/qr-generator.html" style="color:var(--text-body);">QR</a> ·
    <a href="/k/" style="color:var(--text-body);">word of the day</a>
  </div>

</div>

<!-- SEARCH RESULTS -->
<div class="page results-page">
  <div class="sbar">
    <input type="text" id="q2" placeholder="search..." autocomplete="off"
           onkeydown="if(event.key==='Enter')doSearch()">
    <button onclick="doSearch()">Search</button>
  </div>
  <div class="meta" id="meta"></div>
  <div class="results" id="results"></div>
</div>

<!-- FOOTER -->
<div class="ft">
  <div class="ft-row">
    <a href="/about.html">about</a>
    <span class="ft-sep">·</span>
    <a href="/privacy.html">privacy</a>
    <span class="ft-sep">·</span>
    <a href="mailto:matt@death2data.com">contact</a>
    <span class="ft-sep">·</span>
    <span>death2data.com</span>
  </div>
  <div id="auth-area"></div>
</div>

<script>
const S = { token:null, email:null, tier:null, searches:0 };
const API = location.hostname==='localhost' ? '' : 'https://fortune0-com.onrender.com';

/* ── Auth (lives in footer — not in your face) ── */
(function init(){
  const t = localStorage.getItem('d2d_token');
  const e = localStorage.getItem('d2d_email');
  if (t && e) { S.token = t; S.email = e; showUser(); }
  else { showLogin(); }

  const urlQ = new URLSearchParams(location.search).get('q');
  if (urlQ) { setQuery(urlQ); doSearch(); }

  // Stripe return
  const p = new URLSearchParams(location.search);
  if (p.has('paid') || document.referrer.includes('stripe.com')) {
    if (S.email) reauth().then(() => history.replaceState(null, '', '/'));
  }

  // Verify token silently
  if (S.token && S.email) {
    fetch(API+'/api/search?q=ping', {headers:{'Authorization':'Bearer '+S.token}})
      .then(r=>r.json()).then(d=>{
        if (d.authed === false) reauth();
        if (d.tier) { S.tier = d.tier; showUser(); }
      }).catch(()=>{});
  }

  // Community pulse
  fetch(API+'/api/public/stats').then(r=>r.json()).then(d=>{
    const el = document.getElementById('pulse');
    if (!el) return;
    const parts = [];
    if (d.total_users) parts.push(d.total_users + ' members');
    if (d.searches_total) parts.push(d.searches_total + ' searches');
    parts.push('230 domains');
    if (parts.length) el.textContent = parts.join(' · ');
  }).catch(()=>{});
})();

function showUser() {
  // Footer: just sign out link, no email shown
  document.getElementById('auth-area').innerHTML = `
    <div class="ft-user">
      <span class="dot"></span>
      <span>signed in</span>
      <button onclick="logout()">sign out</button>
    </div>`;
  // Join box: upgrade or confirmation
  const box = document.getElementById('join-cta');
  if (S.tier === 'active') {
    box.innerHTML = `
      <div style="font-size:13px;color:var(--text);margin-bottom:4px;">You're in. Search anything.</div>
      <div style="font-size:12px;color:var(--text-dim);">Full web results unlocked.</div>`;
  } else {
    let stripeUrl = 'https://buy.stripe.com/cNieVd5Vjb6N2ZY6Fq4wM00';
    if (S.email) stripeUrl += '?prefilled_email=' + encodeURIComponent(S.email);
    box.innerHTML = `
      <div style="font-size:13px;color:var(--text);margin-bottom:10px;">Search is free. Full web results are $1/mo.</div>
      <a href="${stripeUrl}" style="display:inline-block;padding:10px 24px;background:var(--green);color:#000;font-weight:600;font-size:13px;border-radius:6px;text-decoration:none;">Unlock full search — $1/mo</a>`;
  }
}

function showLogin() {
  document.getElementById('auth-area').innerHTML = '';
  document.getElementById('join-cta').innerHTML = `
    <div style="font-size:13px;color:var(--text);margin-bottom:10px;">Search is free. Full web results are $1/mo.</div>
    <div class="join-row">
      <input type="email" id="email" placeholder="you@example.com" onkeydown="if(event.key==='Enter')login()">
      <button class="join-btn" onclick="login()">Join — $1/mo</button>
    </div>`;
}

async function login() {
  const el = document.getElementById('email');
  const email = el.value.trim().toLowerCase();
  if (!email || !email.includes('@')) { el.placeholder = 'enter your email'; return; }
  el.disabled = true;
  try {
    const r = await fetch(API+'/api/signup', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({email, source_domain:'death2data.com'})
    });
    const d = await r.json();
    if (d.token) {
      S.token = d.token; S.email = d.email; S.tier = d.tier;
      localStorage.setItem('d2d_token', d.token);
      localStorage.setItem('d2d_email', d.email);
      showUser();
      return;
    }
    if (d.exists) {
      const r2 = await fetch(API+'/api/login', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({email, key: ''})
      });
      const d2 = await r2.json();
      if (d2.token) {
        S.token = d2.token; S.email = d2.email; S.tier = d2.tier;
        localStorage.setItem('d2d_token', d2.token);
        localStorage.setItem('d2d_email', d2.email);
        showUser();
        return;
      }
    }
    S.email = email;
    localStorage.setItem('d2d_email', email);
    showUser();
  } catch(e) {
    el.disabled = false;
    el.placeholder = 'try again';
  }
}

async function reauth() {
  if (!S.email) return;
  try {
    const r = await fetch(API+'/api/signup', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({email: S.email, source_domain:'death2data.com'})
    });
    const d = await r.json();
    if (d.token) {
      S.token = d.token; S.tier = d.tier;
      localStorage.setItem('d2d_token', d.token);
    }
  } catch(e) {}
}

function logout() {
  S.token = null; S.email = null; S.tier = null;
  localStorage.removeItem('d2d_token');
  localStorage.removeItem('d2d_email');
  location.reload();
}

/* ── Search ── */
function setQuery(q) {
  document.getElementById('q').value = q;
  document.getElementById('q2').value = q;
}

function getQuery() {
  return (document.getElementById('q2').value || document.getElementById('q').value).trim();
}

async function doSearch() {
  const q = getQuery();
  if (!q) return;
  setQuery(q);
  S.searches++;

  document.body.classList.add('searching');
  document.getElementById('meta').textContent = '';
  document.getElementById('results').innerHTML = '<div class="loading">searching...</div>';
  document.getElementById('q2').focus();

  const warmTimer = setTimeout(() => {
    document.getElementById('results').innerHTML =
      '<div class="loading">server is waking up...<br><span style="font-size:11px;color:var(--text-dim);">free tier cold start, ~30s</span></div>';
  }, 6000);

  let data;
  try {
    const h = {};
    if (S.token) h['Authorization'] = 'Bearer ' + S.token;
    const r = await fetch(API+'/api/search?q='+encodeURIComponent(q), {headers: h});
    data = await r.json();
    clearTimeout(warmTimer);

    if (S.token && data.authed === false && S.email && !S._retrying) {
      S._retrying = true;
      await reauth();
      S._retrying = false;
      return doSearch();
    }
  } catch(e) {
    clearTimeout(warmTimer);
    data = { results: [], count: 0, source: 'error' };
  }

  renderResults(data, q);
}

function renderResults(data, q) {
  const el = document.getElementById('results');
  const meta = document.getElementById('meta');
  const results = data.results || [];
  const source = data.source || '';

  if (results.length > 0) {
    const parts = [`${results.length} result${results.length !== 1 ? 's' : ''}`];
    if (source && source !== 'none') parts.push(source.replace('+', ' + '));
    meta.textContent = parts.join(' · ');
  } else {
    meta.textContent = '';
  }

  let html = '';
  if (results.length === 0 && !data.web_locked) {
    html = '<div class="loading">no results</div>';
  }

  results.forEach(r => {
    const url = r.url || '#';
    const domain = url !== '#' ? url.replace(/^https?:\/\//, '').split('/')[0] : '';
    const storyUrl = url !== '#' ? `/story.html?url=${encodeURIComponent(url)}&q=${encodeURIComponent(q)}` : '';

    html += `<div class="card" ${storyUrl ? `onclick="location.href='${storyUrl}'"` : ''}>
      <div class="card-title">${r.title || ''}</div>
      ${domain ? `<div class="card-url">${domain}</div>` : ''}
      <div class="card-snip">${r.snippet || r.content || ''}</div>
    </div>`;
  });

  if (data.web_locked) {
    let stripeUrl = 'https://buy.stripe.com/cNieVd5Vjb6N2ZY6Fq4wM00';
    if (S.email) stripeUrl += '?prefilled_email=' + encodeURIComponent(S.email);
    html += `<div class="paywall">
      <p>Full web results need a $1/mo membership</p>
      <a href="${stripeUrl}" target="_blank">Get full access</a>
    </div>`;
  }

  el.innerHTML = html;
}
</script>
</body>
</html>
