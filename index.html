<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Death2Data - Private Search</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: system-ui, -apple-system, sans-serif;
  background: #0a0a0a;
  color: #fff;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* Top bar */
.topbar {
  display: flex;
  justify-content: flex-end;
  padding: 15px 20px;
  gap: 15px;
  font-size: 13px;
}
.topbar a {
  color: #888;
  text-decoration: none;
}
.topbar a:hover { color: #0f0; }
.topbar .member-link { color: #0f0; }

/* Center content */
.center {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 0 20px;
  margin-top: -80px;
}

/* Logo */
.logo {
  font-size: 3rem;
  font-weight: 900;
  letter-spacing: -1px;
  margin-bottom: 30px;
}
.logo .death { color: #fff; }
.logo .two { color: #666; }
.logo .data { color: #0f0; }

/* Search */
.search-wrap {
  width: 100%;
  max-width: 580px;
  margin-bottom: 20px;
}
.search-box {
  display: flex;
  background: #111;
  border: 1px solid #333;
  border-radius: 24px;
  overflow: hidden;
  transition: border-color 0.2s;
}
.search-box:focus-within {
  border-color: #0f0;
}
.search-box input {
  flex: 1;
  background: none;
  border: none;
  color: #fff;
  padding: 16px 24px;
  font-size: 16px;
  outline: none;
}
.search-box input::placeholder { color: #555; }
.search-box button {
  background: none;
  border: none;
  color: #0f0;
  padding: 16px 24px;
  cursor: pointer;
  font-size: 16px;
  font-weight: bold;
}
.search-box button:hover { background: #0f01; }

/* Action buttons */
.actions {
  display: flex;
  gap: 12px;
  margin-bottom: 30px;
}
.actions button {
  background: #111;
  border: 1px solid #222;
  color: #ccc;
  padding: 10px 20px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 13px;
}
.actions button:hover {
  border-color: #0f0;
  color: #0f0;
}

/* Results */
#results {
  width: 100%;
  max-width: 580px;
  margin-top: 10px;
}
.result-summary {
  background: #001a00;
  border: 1px solid #0f03;
  padding: 15px 20px;
  border-radius: 8px;
  margin-bottom: 15px;
}
.result-summary .label {
  color: #0f0;
  font-size: 11px;
  font-family: monospace;
  margin-bottom: 8px;
}
.result-summary p {
  color: #ddd;
  line-height: 1.6;
  font-size: 14px;
}
.result-item {
  padding: 12px 0;
  border-bottom: 1px solid #1a1a1a;
}
.result-item a {
  color: #0f0;
  text-decoration: none;
  font-size: 15px;
}
.result-item a:hover { text-decoration: underline; }
.result-item .url {
  color: #555;
  font-size: 12px;
  margin-top: 3px;
}
.result-item .snippet {
  color: #999;
  font-size: 13px;
  margin-top: 5px;
  line-height: 1.5;
}
.result-actions {
  display: flex;
  gap: 10px;
  margin-top: 15px;
}
.result-actions a {
  color: #0f0;
  text-decoration: none;
  font-size: 13px;
  padding: 8px 16px;
  border: 1px solid #0f03;
  border-radius: 4px;
}
.result-actions a:hover {
  background: #0f01;
  border-color: #0f0;
}

/* Footer links */
.footer-links {
  display: flex;
  flex-wrap: wrap;
  gap: 8px 20px;
  justify-content: center;
  max-width: 580px;
  margin-bottom: 10px;
}
.footer-links a {
  color: #555;
  text-decoration: none;
  font-size: 12px;
}
.footer-links a:hover { color: #0f0; }

/* Bottom bar */
.bottom {
  border-top: 1px solid #1a1a1a;
  padding: 15px 20px;
  text-align: center;
  font-size: 12px;
  color: #333;
}

/* Upgrade banner for free users */
.upgrade-bar {
  background: #111;
  border: 1px solid #222;
  border-radius: 20px;
  padding: 8px 20px;
  font-size: 12px;
  color: #888;
  margin-bottom: 20px;
  display: none;
}
.upgrade-bar a { color: #0f0; text-decoration: none; font-weight: bold; }

/* Search history */
.history {
  width: 100%;
  max-width: 580px;
  margin-top: 15px;
}
.history-label {
  color: #444;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 8px;
}
.history-items {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}
.history-items a {
  color: #666;
  text-decoration: none;
  font-size: 12px;
  padding: 4px 10px;
  background: #111;
  border-radius: 12px;
  border: 1px solid #1a1a1a;
}
.history-items a:hover { color: #0f0; border-color: #333; }
</style>
</head>
<body>

<!-- Top bar -->
<div class="topbar">
  <a href="/browse.html">Browse</a>
  <a href="/keyword.html">Tools</a>
  <a href="/notes.html">Notebook</a>
  <a id="account-link" href="/me.html">Account</a>
</div>

<!-- Center -->
<div class="center">
  <div class="logo">
    <span class="death">DEATH</span><span class="two">2</span><span class="data">DATA</span>
  </div>

  <div class="search-wrap">
    <div class="search-box">
      <input type="text" id="query" placeholder="Search privately..." autofocus>
      <button onclick="doSearch()">Search</button>
    </div>
  </div>

  <div class="actions">
    <button onclick="doSearch()">Private Search</button>
    <button onclick="feelingLucky()">Browse Random Wiki</button>
  </div>

  <div id="upgrade-bar" class="upgrade-bar">
    5 free browses/day ¬∑ <a href="https://buy.stripe.com/cNieVd5Vjb6N2ZY6Fq4wM00">Unlock unlimited ‚Üí $1/mo</a>
  </div>

  <!-- Results appear here -->
  <div id="results"></div>

  <!-- Search history -->
  <div class="history" id="history-section" style="display:none;">
    <div class="history-label">Recent</div>
    <div class="history-items" id="history-items"></div>
  </div>

  <div class="footer-links">
    <a href="/browse.html">Private Browse</a>
    <a href="https://en.wikipedia.org/wiki/Data_broker" onclick="event.preventDefault();window.location='/browse.html?url='+this.href">Data Brokers</a>
    <a href="https://en.wikipedia.org/wiki/Privacy" onclick="event.preventDefault();window.location='/browse.html?url='+this.href">Privacy</a>
    <a href="/docs/">Docs</a>
    <a href="mailto:matt@death2data.com">Contact</a>
    <a href="https://github.com/deathtodata">GitHub</a>
  </div>
</div>

<div class="bottom">
  No tracking. No ads. Your data stays on your device. ¬∑ <a href="https://buy.stripe.com/cNieVd5Vjb6N2ZY6Fq4wM00" style="color:#0f0;text-decoration:none;">Join for $1/month</a>
</div>

<script>
const API = 'https://api.death2data.com';
let searches = JSON.parse(localStorage.getItem('d2d_searches') || '[]');

// Check member status
(function(){
  var paid = localStorage.getItem('d2d_paid');
  var email = localStorage.getItem('d2d_email');
  if (paid && email) {
    document.getElementById('account-link').textContent = email.split('@')[0];
    document.getElementById('account-link').classList.add('member-link');
  } else {
    document.getElementById('upgrade-bar').style.display = 'block';
  }
})();

// Show search history
function renderHistory() {
  if (searches.length === 0) return;
  document.getElementById('history-section').style.display = 'block';
  document.getElementById('history-items').innerHTML = searches.slice(0, 8).map(s =>
    '<a href="#" onclick="event.preventDefault();document.getElementById(\'query\').value=\'' + s.query.replace(/'/g, "\\'") + '\';doSearch();">' + s.query + '</a>'
  ).join('');
}
renderHistory();

// Enter key
document.getElementById('query').addEventListener('keypress', function(e) {
  if (e.key === 'Enter') doSearch();
});

function feelingLucky() {
  const topics = ['Privacy','Encryption','Data_broker','Surveillance','Cryptography','Internet_privacy','Virtual_private_network','Tor_(network)','Signal_(software)','Open-source_software'];
  const pick = topics[Math.floor(Math.random() * topics.length)];
  window.location = '/browse.html?url=https://en.wikipedia.org/wiki/' + pick;
}

function doSearch() {
  const query = document.getElementById('query').value.trim();
  if (!query) return;

  // Save to history
  searches.unshift({ query: query, timestamp: new Date().toISOString() });
  if (searches.length > 50) searches = searches.slice(0, 50);
  localStorage.setItem('d2d_searches', JSON.stringify(searches));

  // Log to API (silent)
  fetch(API + '/search?q=' + encodeURIComponent(query)).catch(function(){});

  // Show loading
  var results = document.getElementById('results');
  results.innerHTML = '<p style="color:#0f0;text-align:center;padding:20px;">Searching...</p>';

  // Fetch from API
  fetch(API + '/search?q=' + encodeURIComponent(query))
    .then(function(r) { return r.json(); })
    .then(function(data) {
      var html = '';

      // DuckDuckGo abstract
      if (data.abstract) {
        html += '<div class="result-summary">';
        html += '<div class="label">INSTANT ANSWER</div>';
        html += '<p>' + data.abstract + '</p>';
        if (data.source) html += '<p style="color:#555;font-size:11px;margin-top:8px;">Source: ' + data.source + '</p>';
        html += '</div>';
      }

      // ARK insight
      if (data.ark) {
        html += '<div class="result-summary">';
        html += '<div class="label">ARK RESEARCH</div>';
        html += '<p>' + data.ark.prediction + '</p>';
        html += '<p style="color:#555;font-size:11px;margin-top:8px;">ARK Big Ideas 2026, Page ' + data.ark.page + '</p>';
        html += '</div>';
      }

      // Community trend
      if (data.community_trend > 0) {
        html += '<p style="color:#666;font-size:12px;margin-bottom:10px;">' + data.community_trend + ' other members searched this</p>';
      }

      // Related topics
      if (data.related && data.related.length) {
        data.related.slice(0, 5).forEach(function(r) {
          if (r.Text && r.FirstURL) {
            html += '<div class="result-item">';
            html += '<a href="/browse.html?url=' + encodeURIComponent(r.FirstURL) + '">' + r.Text + '</a>';
            html += '<div class="url">' + r.FirstURL + '</div>';
            html += '</div>';
          }
        });
      }

      // Action buttons
      var wikiUrl = 'https://en.wikipedia.org/wiki/' + encodeURIComponent(query.replace(/ /g, '_'));
      html += '<div class="result-actions">';
      html += '<a href="/browse.html?url=' + encodeURIComponent(wikiUrl) + '">üìñ Read on Wikipedia</a>';
      html += '<a href="https://searx.be/search?q=' + encodeURIComponent(query) + '" target="_blank">üîç Deep Search</a>';
      if (data.url) html += '<a href="/browse.html?url=' + encodeURIComponent(data.url) + '">üìÑ Browse Source</a>';
      html += '</div>';

      results.innerHTML = html || '<p style="color:#888;text-align:center;padding:20px;">No results found</p>';
      renderHistory();
    })
    .catch(function() {
      results.innerHTML = '<p style="color:#f66;text-align:center;padding:20px;">Search failed - try again</p>';
    });
}

// Load live stats
fetch(API + '/stats').then(r => r.json()).then(data => {
  // Subtle - don't clutter the page
}).catch(function(){});
</script>

</body>
</html>
