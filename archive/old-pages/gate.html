<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>D2D - Enter</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: system-ui, sans-serif;
  background: #000;
  color: #fff;
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}
.gate { max-width: 500px; width: 100%; text-align: center; }
.word { font-size: 64px; font-weight: 900; color: #0f0; margin-bottom: 10px; }
.prompt { color: #888; margin-bottom: 30px; font-size: 18px; }
textarea {
  width: 100%;
  height: 120px;
  background: #111;
  border: 1px solid #333;
  color: #fff;
  padding: 15px;
  font-size: 16px;
  margin-bottom: 15px;
}
textarea:focus { outline: none; border-color: #0f0; }
button {
  background: #0f0;
  color: #000;
  border: none;
  padding: 15px 40px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  width: 100%;
}
button:disabled { background: #333; color: #666; }
.or { color: #444; margin: 20px 0; }
.pay-link { color: #666; text-decoration: none; border-bottom: 1px solid #333; }
.pay-link:hover { color: #0f0; border-color: #0f0; }
.status { margin-top: 20px; padding: 15px; background: #111; font-family: monospace; font-size: 12px; }
.status.unlocked { border-left: 2px solid #0f0; }
.enter-link { display: none; margin-top: 20px; }
.enter-link a { color: #0f0; font-size: 20px; text-decoration: none; }
</style>

    <script src="config.js"></script>
    </head>
<body>

<div class="gate">
  <div class="word" id="word">...</div>
  <div class="prompt" id="prompt">Loading...</div>
  
  <div id="form-area">
    <textarea id="response" placeholder="Share your perspective to unlock access..."></textarea>
    <button id="submit" onclick="submit()">Unlock Free Access</button>
    
    <div class="or">— or —</div>
    <a href="https://buy.stripe.com/cNieVd5Vjb6N2ZY6Fq4wM00" class="pay-link">Pay $1/month for full access</a>
  </div>
  
  <div class="status" id="status"></div>
  
  <div class="enter-link" id="enter-link">
    <a href="/index.html">→ Enter Death2Data</a>
  </div>
</div>

<script>
const API = 'https://api.death2data.com';

async function load() {
  // Check existing access
  const access = JSON.parse(localStorage.getItem('d2d_access') || '{}');
  updateStatus(access);
  
  // Get word of the day
  try {
    const wotd = await fetch(`${API}/wotd`).then(r => r.json());
    document.getElementById('word').textContent = wotd.word.toUpperCase();
    document.getElementById('prompt').textContent = wotd.prompt;
  } catch {
    document.getElementById('word').textContent = 'PRIVACY';
    document.getElementById('prompt').textContent = 'What does privacy mean to you?';
  }
}

function updateStatus(access) {
  const status = document.getElementById('status');
  const tier = access.tier || 0;
  const contributions = access.contributions || 0;
  const expires = access.expires || 0;

  // Check if access expired
  if (tier >= 1 && expires && Date.now() > expires) {
    status.className = 'status';
    status.innerHTML = `ACCESS: EXPIRED | Your 24hr free access expired. Contribute again or <a href="https://buy.stripe.com/cNieVd5Vjb6N2ZY6Fq4wM00" style="color:#0f0;">pay $1/month</a>`;
    document.getElementById('enter-link').style.display = 'none';
    document.getElementById('form-area').style.display = 'block';
    return;
  }

  if (tier >= 1) {
    const hoursLeft = Math.floor((expires - Date.now()) / (1000 * 60 * 60));
    status.className = 'status unlocked';
    status.innerHTML = `ACCESS: TIER ${tier} | CONTRIBUTIONS: ${contributions} | <span style="color:#0f0">UNLOCKED</span> (${hoursLeft}h remaining)`;
    document.getElementById('enter-link').style.display = 'block';
    document.getElementById('form-area').style.display = 'none';
  } else {
    status.innerHTML = `ACCESS: LOCKED | Contribute to unlock`;
  }
}

async function submit() {
  const btn = document.getElementById('submit');
  const response = document.getElementById('response').value.trim();
  const word = document.getElementById('word').textContent.toLowerCase();
  
  if (response.length < 10) {
    alert('Please write a bit more (at least 10 characters)');
    return;
  }
  
  btn.disabled = true;
  btn.textContent = 'Unlocking...';
  
  try {
    // Submit perspective
    await fetch(`${API}/perspective`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ keyword: word, perspective: response })
    });
    
    // Update local access with 24hr timer
    const access = JSON.parse(localStorage.getItem('d2d_access') || '{}');
    access.tier = Math.min((access.tier || 0) + 1, 3);
    access.contributions = (access.contributions || 0) + 1;
    access.lastContribution = Date.now();
    access.expires = Date.now() + (24 * 60 * 60 * 1000);  // 24hr access
    access.history = access.history || [];
    access.history.push({ word, response, timestamp: Date.now() });
    localStorage.setItem('d2d_access', JSON.stringify(access));

    updateStatus(access);
    
  } catch (e) {
    alert('Error. Try again.');
    btn.disabled = false;
    btn.textContent = 'Unlock Free Access';
  }
}

load();
</script>

</body>
</html>
