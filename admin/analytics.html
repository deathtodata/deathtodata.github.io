<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>D2D - Your Analytics</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: monospace;
  background: #000;
  color: #00cc44;
  padding: 40px;
  line-height: 1.6;
}
h1 { margin-bottom: 30px; }
.section { margin-bottom: 40px; }
.section h2 { color: #fff; font-size: 14px; margin-bottom: 15px; border-bottom: 1px solid #222; padding-bottom: 10px; }
.stat { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #111; }
.stat-label { color: #666; }
.stat-value { color: #00cc44; }
.comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px; }
.box { background: #111; padding: 20px; border: 1px solid #222; }
.box h3 { color: #888; font-size: 12px; margin-bottom: 15px; }
.big-number { font-size: 48px; color: #00cc44; }
.small-label { font-size: 12px; color: #666; }
.your-searches { max-height: 300px; overflow-y: auto; }
.search-item { padding: 8px 0; border-bottom: 1px solid #111; font-size: 14px; }
.search-item span { color: #666; font-size: 12px; }
.insight { background: rgba(0,204,68,0.07); border-left: 2px solid #00cc44; padding: 15px; margin-top: 20px; }
.export-btn { background: #00cc44; color: #000; border: none; padding: 10px 20px; cursor: pointer; margin-top: 20px; }
</style>

    <script src="/config.js"></script>
    </head>
<body>

<h1>YOUR DATA</h1>

<div class="comparison">
  <div class="box">
    <h3>YOUR LOCAL SEARCHES</h3>
    <div class="big-number" id="local-count">0</div>
    <div class="small-label">stored on your device</div>
  </div>
  <div class="box">
    <h3>D2D NETWORK TOTAL</h3>
    <div class="big-number" id="network-count">-</div>
    <div class="small-label">anonymous aggregate</div>
  </div>
</div>

<div class="section" style="margin-top:40px;">
  <h2>YOUR SEARCH HISTORY (local only - we can't see this)</h2>
  <div class="your-searches" id="your-searches">
    <p style="color:#666;">No local searches yet. Use the search tool to start.</p>
  </div>
  <button class="export-btn" onclick="exportData()">Export Your Data (JSON)</button>
  <button class="export-btn" onclick="clearData()" style="background:#f00;">Clear All Local Data</button>
</div>

<div class="section">
  <h2>NETWORK INSIGHTS (aggregated, anonymous)</h2>
  <div id="insights">Loading...</div>
</div>

<div class="section">
  <h2>YOUR PERSPECTIVES</h2>
  <div id="perspectives">
    <p style="color:#666;">None submitted yet.</p>
  </div>
</div>

<div class="insight">
  <strong>Privacy note:</strong> Your search history stays in your browser (localStorage). 
  The network only sees anonymous counts. We cannot connect searches to you.
</div>

<script>
async function load() {
  // Local data
  const searches = JSON.parse(localStorage.getItem('d2d_searches') || '[]');
  const perspectives = JSON.parse(localStorage.getItem('d2d_perspectives') || '[]');
  
  document.getElementById('local-count').textContent = searches.length;
  
  if (searches.length > 0) {
    document.getElementById('your-searches').innerHTML = searches
      .slice(-50)
      .reverse()
      .map(s => `<div class="search-item">${s.query} <span>${new Date(s.timestamp).toLocaleString()}</span></div>`)
      .join('');
  }
  
  if (perspectives.length > 0) {
    document.getElementById('perspectives').innerHTML = perspectives
      .map(p => `<div class="search-item"><strong>${p.keyword}:</strong> ${p.perspective}</div>`)
      .join('');
  }
  
  // Network data
  try {
    const data = await fetch('https://fortune0-com.onrender.com/api/analytics', {headers:{'Authorization':'Bearer '+(localStorage.getItem('d2d_token')||'')}}).then(r => r.json());
    document.getElementById('network-count').textContent = data.totalSearches;
    
    document.getElementById('insights').innerHTML = `
      <div class="stat"><span class="stat-label">Total Members</span><span class="stat-value">${data.totalMembers}</span></div>
      <div class="stat"><span class="stat-label">Searches This Week</span><span class="stat-value">${data.searchesThisWeek}</span></div>
      <div class="stat"><span class="stat-label">Top Queries</span><span class="stat-value">${data.topQueries.map(q => q.query).join(', ') || 'none yet'}</span></div>
      <div class="stat"><span class="stat-label">Your % of Network</span><span class="stat-value">${data.totalSearches ? ((searches.length / data.totalSearches) * 100).toFixed(1) : 0}%</span></div>
    `;
  } catch {
    document.getElementById('insights').innerHTML = '<p style="color:#666;">Could not load network data.</p>';
  }
}

function exportData() {
  const data = {
    searches: JSON.parse(localStorage.getItem('d2d_searches') || '[]'),
    perspectives: JSON.parse(localStorage.getItem('d2d_perspectives') || '[]'),
    notes: JSON.parse(localStorage.getItem('d2d_notes') || '[]'),
    exported: new Date().toISOString()
  };
  
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `d2d-export-${Date.now()}.json`;
  a.click();
}

function clearData() {
  if (confirm('Delete ALL your local data? This cannot be undone.')) {
    localStorage.removeItem('d2d_searches');
    localStorage.removeItem('d2d_perspectives');
    localStorage.removeItem('d2d_notes');
    location.reload();
  }
}

load();
</script>

</body>
</html>
